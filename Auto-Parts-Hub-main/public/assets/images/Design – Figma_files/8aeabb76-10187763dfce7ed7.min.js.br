"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="01108875-d422-5138-b06c-d4d72788e83a")}catch(e){}}();
(globalThis.webpackChunk_figma_web_bundler=globalThis.webpackChunk_figma_web_bundler||[]).push([[5491],{561932:(e,t,l)=>{l.d(t,{P:()=>D,v:()=>w});var a=l(848318),n=l(716544),s=l(741419),d=l(980399);if(443==l.j)var r=l(813321);var o=l(579020),i=l(397579),c=l(427193),u=l(182059),m=l(473889),f=l(771186),p=l(575492),g=l(197945),E=l(166365),b=l(442313),h=l(790355),C=l(789269),y=l(950738),k=l(51910),v=l(369600),I=l(793954),N=l(877297),_=l(205397),P=l(810968),S=l(763554);if(443==l.j)var x=l(523860);if(443==l.j)var M=l(862045);if(443==l.j)var O=l(85206);var w=(e=>(e.LOADED="post-to-feed-view-loaded",e.SELECT_NODE="post-to-feed-select-node",e))(w||{});function F(e){return a.createElement("div",{className:null!==e.isSelectedIdx?S.El:S.Vs,onClick:e.onClick,role:"button",tabIndex:0,ref:t=>{t&&e.observe(t)},"data-observer-guid":e.node.guid},a.createElement("div",{className:S.h3,style:{backgroundColor:e.backgroundColor}},a.createElement(f.x,{isLoading:!e.thumbnailUrl},()=>a.createElement("img",{className:S.xn,src:e.thumbnailUrl,alt:"",draggable:!1}))),a.createElement("div",{className:S.JO},a.createElement("div",{className:S.qp},e.node.name)),null!==e.isSelectedIdx&&1!==e.totalNumSelected&&a.createElement("div",{className:S.Jx},e.isSelectedIdx+1))}function T(e){let{toggleSelectNode:t}=e,l=(e.pageNode&&(0,d.colorToHex)(e.pageNode.backgroundColor))??"",[n,s]=a.useState(!1),r=a.useCallback(a=>{t(a,{pageId:e.pageNode.guid,pageBackgroundColor:l})},[t,e.pageNode.guid,l]);return a.createElement("div",{className:S.RW},e.showCollapsibleHeader&&a.createElement("div",{className:S.Vr,onClick:()=>s(e=>!e),role:"button",tabIndex:0},n?a.createElement(E.B,{svg:O.A,className:S.Rq}):a.createElement(E.B,{svg:x.A,className:S.Rq}),e.pageNode.name,"\xa0",a.createElement("span",{className:S.Du},"\xb7 ",e.nodes.length)),!n&&a.createElement("div",{className:S.Mc},e.nodes.map(t=>{let n=e.selectedNodeGuids?.indexOf(t.guid)??null;return a.createElement(F,{key:`node-${t.guid}`,node:t,thumbnailUrl:e.thumbnailByGuid[t.guid]?.url??"",backgroundColor:l,isSelectedIdx:-1===n?null:n,onClick:()=>r(t.guid),totalNumSelected:e.selectedNodeGuids?.length??null,observe:e.observe})})))}let K="feed-post-page-selector-menu";function D(){let e=a.useCallback((e,t)=>{let l=window.parent;window.self.origin===l.origin&&l&&l.postMessage({type:e,data:t})},[]),t=a.useRef(new c.jk("feed_post_to_file_load",{}));a.useEffect(()=>{t.current.start()},[]);let l=(0,k.aV)(),d=(0,k.eY)(),f=(0,v.tS)();a.useEffect(()=>{if(!l){t.current.stop();let l=t.current.getElapsedTime();(0,o.sx)("team_feed.post_from_file.file_load",{elapsedMs:l,fileKey:f}),e("post-to-feed-view-loaded",!0)}},[l,e,f]);let x=(0,n.d4)(e=>e.mirror.appModel.pagesList),O=a.useMemo(()=>x.reduce((e,t)=>({...e,[t.nodeId]:d.get(t.nodeId)}),{}),[x,d]),w=(0,n.wA)(),F=a.useMemo(()=>Object.values(O).flatMap(e=>e?e.uiOrderedChildren.map(t=>{let l=d.get(t);return l&&("FRAME"===l.type||"SECTION"===l.type)?{...l,pageId:e.guid,name:l?.name}:null}).filter(e=>e):[]).filter(e=>null!==e),[O,d]),D=a.useMemo(()=>{let e={};for(let t of F)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[F]),A=a.useMemo(()=>new I.Ef(F,{keys:["name"]}),[F]),[R,j]=a.useState(""),[U,B]=a.useState(null),[L]=(0,r.A)(R,200),Y=a.useCallback(e=>{B(A.search(e))},[A]),q=a.useMemo(()=>{if(null===U)return null;let e={};for(let t of U)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[U]);a.useEffect(()=>{""!==L&&Y(L)},[L,Y]);let z=(0,y.Um)(),Z=a.useRef(null),[G,H]=a.useState(null);a.useEffect(()=>{if(G||!d||!D||0===Object.keys(D).length)return;let e=d.get(Object.keys(D)[0]);e&&H(e)},[G,D,d]);let[J,V]=a.useState({}),[$,Q]=a.useState([]),W=(0,i.ZC)($),X=a.useRef(null),[ee,et]=a.useState([]),el=a.useCallback(e=>{let t=[];e.forEach(e=>{if(e.isIntersecting&&e.target instanceof HTMLElement){let l=e.target.dataset?.observerGuid;l&&t.push(l)}}),et(t)},[]),ea=a.useMemo(()=>new IntersectionObserver(el,{threshold:[.25]}),[el]),en=a.useCallback(e=>{ea&&ea.observe(e)},[ea]),[es,ed]=a.useState({});a.useEffect(()=>{if(0===ee.length)return;let e=ee.filter(e=>!es[e]);0!==e.length&&(0,C.Jr)().loadAllImagesUnder(e,s.MoD.NON_ANIMATED_ONLY,"feed.postFromFile").then(()=>{e.forEach(e=>{setTimeout(()=>{ed(t=>{if(t[e])return t;let l=(0,P.BO)(e);return{...t,[e]:{url:URL.createObjectURL(new Blob([l])),data:l}}})},0)})})},[ee,es]),a.useEffect(()=>{$!==W&&e("post-to-feed-select-node",$.map(e=>({guid:e,thumbnail:es[e].data,backgroundColor:J[e]})))},[W,$,e,es,J]);let er=a.useCallback((e,t)=>{es[e]&&(V(l=>t.pageBackgroundColor?{...l,[e]:t.pageBackgroundColor}:l),Q(t=>t.includes(e)?t.filter(t=>e!==t):t.length>=N.e3?t:[...t,e]))},[es]);return D&&0===Object.keys(D).length?a.createElement("div",{className:S.se},(0,b.t)("fig_feed.no_top_level_nodes")):G?a.createElement("div",{className:S.kL},a.createElement("div",{className:S.Y},a.createElement(g.IW,{query:R,className:S.ON,onChange:j,clearSearch:()=>{j(""),B(null)},focusOnMount:!1,iconClassName:S.qc,placeholder:(0,b.t)("fig_feed.search_frames")}),""===R&&a.createElement(a.Fragment,null,a.createElement("div",{role:"button",ref:Z,onClick:()=>{z?.type===K?w(h.oB()):w(h.j7({type:K}))},tabIndex:0,className:S.YZ},a.createElement("div",null,G.name),a.createElement(E.B,{svg:M.A,width:"8px",autosize:!0})),Z.current&&z?.type===K&&a.createElement(_.Cf,{showPoint:!1,targetRect:Z.current.getBoundingClientRect(),propagateCloseClick:!0},Object.keys(D).map(e=>a.createElement(u.MM,{key:e,onClick:()=>H(O[e]),checked:G.guid===e},O[e].name))))),a.createElement(p.P,{hideScrollbar:!0,className:S.jG,innerClassName:S.hu,scrollContainerRef:X},""===R&&a.createElement(T,{pageNode:G,nodes:D[G.guid]||[],thumbnailByGuid:es,selectedNodeGuids:$,toggleSelectNode:er,observe:en}),""!==R&&(null===q?a.createElement("div",{className:S.Do},a.createElement(m.kt,{size:"large"})):Object.entries(q).length>0?Object.entries(q).map(([e,t])=>a.createElement(T,{key:e,pageNode:O[e],nodes:t,thumbnailByGuid:es,selectedNodeGuids:$,toggleSelectNode:er,showCollapsibleHeader:!0,observe:en})):a.createElement("div",{className:S.Lp},a.createElement("div",null,(0,b.tx)("fig_feed.no_frames_matching",{searchQuery:a.createElement(a.Fragment,null,a.createElement("span",{className:S.ZF},R))})))))):null}},72157:(e,t,l)=>{l.r(t),l.d(t,{EditFeedPostModal:()=>Y});var a=l(848318),n=l(716544),s=l(157907),d=l(536384),r=l.n(d),o=l(579020),i=l(193324),c=l(857188),u=l(493554),m=l(757033),f=l(63571),p=l(145015),g=l(473889),E=l(280198),b=l(442313),h=l(697714),C=l(110979),y=l(449737),k=l(507720),v=l(87089),I=l(661780),N=l(635547),_=l(825749),P=l(707717),S=l(850898),x=l(877297),M=l(568496),O=l(823888),w=l(318342),F=l(810968),T=l(295787),K=l(801092),D=l(583518),A=l(582538),R=l(699321),j=l(123714),U=l(89394),B=l(494874),L=l(611928);function Y(e){let t=(0,n.wA)(),l=a.useCallback(()=>{t(y.Ce())},[t]),s=(0,b.tx)("fig_feed.edit_post"),d=e.feedPostUuid;!d&&e.feedPostThreadId&&(d=(0,M.gk)(e.feedPostThreadId));let r=(0,u.Rs)(N.FHz,{publicUuid:d},{enabled:!e.preloadedFeedPost&&!!d}),o=a.useMemo(()=>e.preloadedFeedPost?e.preloadedFeedPost:"loaded"===r.status?r.data.feedPost:null,[e.preloadedFeedPost,r]);return a.createElement(j.j,{title:s,onClose:l},o?a.createElement(q,{onSubmitSuccess:e.onSubmitSuccess,entryPoint:e.entryPoint,lockedFileKey:e.lockedFileKey,feedPost:o}):a.createElement("div",{className:L._5},a.createElement(g.kt,{size:"large"})))}function q(e){let t=(0,n.wA)(),l=(0,v.sZ)(),d=(0,I.iZ)(),[u,N]=a.useState(!0),[M,j]=a.useState(!1),[Y,q]=a.useState(!1),z=e.feedPost.publicUuid,Z=a.useMemo(()=>e.feedPost.content.map(e=>JSON.parse(e)),[e.feedPost]),[G,H]=a.useState(Z.reduce((e,t)=>{if(t.type!==x.cM.NODE)return e;e.fileKey=t.fileKey;let l=t.nodeId;return e.nodeIds.push(l),e},{fileKey:e.feedPost.fileKey||"",nodeIds:[]})),J=a.useMemo(()=>{let e=Z.find(e=>e.type===x.cM.PROTOTYPE);return e?{fileKey:e.fileKey,pageId:e.pageId,startingNodeId:e.startingNodeId}:null},[Z]),[V,$]=a.useState(0),Q=a.useCallback(()=>{t(y.Ce())},[t]),W=a.useCallback(()=>{t((0,y.to)({type:U.h,data:{onConfirm:Q},showModalsBeneath:!0}))},[t,Q]),X=e.lockedFileKey||G?.fileKey||J?.fileKey;a.useEffect(()=>{let t={entryPoint:e.entryPoint};X&&(t.fileKey=X),(0,o.sx)("Team Feed Edit Post Modal Opened",t)},[e.entryPoint,X]);let ee=a.useCallback((e,a,n)=>{if(a){t(y.Ce());return}let s={text:(0,b.t)("fig_feed.view_post"),action:()=>{t(C.V3({url:(0,O.Kc)(l.id,{uuid:e})}))}};t(h.F.enqueue({message:(0,b.t)("fig_feed.post_edited"),button:n?s:void 0})),t(y.Ce())},[t,l]),[et,el]=a.useState(Z.map(e=>{let t=(0,F.EU)(e),l=(0,x.aT)(e)&&!!e.hasPreviousEditPreview,a={...e,copiedToS3:e.type===x.cM.NODE||e.type===x.cM.PROTOTYPE,shouldBlockEditPreview:l&&!t};return{displayContentItem:a,processedContentItem:Promise.resolve(a)}})),ea=a.useMemo(()=>new Set(et.map(e=>e.displayContentItem.type===x.cM.NODE?e.displayContentItem.nodeId:null).filter(e=>null!==e)),[et]);a.useEffect(()=>{(0,T.sr)(G,ea,el,l?.id)},[G,ea,el,l?.id]);let en=a.useCallback(e=>{let t=(0,A.K1)(et[V].displayContentItem);$(e.findIndex(e=>(0,A.K1)(e)===t));let l=[];e.forEach(e=>{let t=(0,A.K1)(e),a=et.find(e=>(0,A.K1)(e.displayContentItem)===t);a?l.push(a):console.error("Expected to have a matchedPendingItem")}),el(l)},[et,V]),es=a.useCallback(e=>{$(et.findIndex(t=>(0,A.K1)(t.displayContentItem)===e))},[et]),{setContentPreview:ed,snapshotStates:er}=(0,T.eh)(et,el),{onSubmitSuccess:eo}=e,ei=a.useCallback((l,a)=>{m.Ay.put(`/api/feed_posts/${z}`,l).then(l=>{ee(l.data.meta.public_uuid,a,e.entryPoint===w.M2.FILE),a&&t(h.F.enqueue({message:(0,b.t)("fig_feed.post_submission_pending")})),eo&&eo(a)}).catch(()=>{t(E.s.error((0,b.t)("fig_feed.error_on_feed_post_creation"))),N(!1)})},[t,ee,eo,z,e.entryPoint]),[ec,eu]=a.useState(e.feedPost.title||""),[em,ef]=a.useState((0,k.o8)(e.feedPost.descriptionMeta)),ep=a.useMemo(()=>({library:new P.M8(l.id)}),[l]);a.useEffect(()=>{N(ec.trim().length>D.Y||(0,i._Z)(em).length>D.e||0===et.length)},[ec,em,et.length]);let eg=async a=>{if(!l||u)return;a?.preventDefault(),N(!0);let n={description_meta:em,org_id:l.id},s=(0,i._Z)(em);n.content=await (0,F.pj)(t,et,X??"",ec),(0,o.sx)("team_feed_content_awaited",{payloadContent:JSON.stringify(n.content)},{logFromProber:!0});let d=n.content.some(e=>e.pending);ec?n.title=ec:n.title=s.length>0?s.slice(0,40)+"\u2026":(0,b.t)("fig_feed.untitled_post"),X&&(n.attached_file_key=X),ei(n,d),(0,o.sx)("Team Feed Post Edited",{fileKey:X,entryPoint:e.entryPoint,text:s,numContentItems:n.content.length,contentItemTypes:n.content.map(e=>e.type)},{forwardToDatadog:!0})},eE=a.useCallback((e,a)=>{if(!l)return;let n=Array.from(e);if(0===n.length)return;let s=(0,_.KT)(n,et.length,x.e3,x.bB,e=>{t(h.F.enqueue({message:(0,R.getUploadErrorMessage)(e)}))},et.map(e=>e.fileIdentifier)).map(e=>{let t=(0,_.Fn)(e);if(S.xp.includes(e.type))return(0,F.zr)(t,e);if(S.VY.includes(e.type))return(0,F.X2)(t,z,l.id,e);throw Error("unexpected file type")}),d=void 0!==a?a:et.length;el(e=>[...e.slice(0,d),...s,...e.slice(d)]),$(d)},[t,l,z,et]),eb=a.useCallback((e,t)=>()=>{let l=e.current?.files||null;null!==l&&0!==l.length&&(eE(l,t),e.current&&(e.current.value=""))},[eE]),eh=a.useCallback(e=>{let t=Math.min(e,Math.max(0,et.length-2)),l=et[e];if((0,F.AK)(l),el(t=>t.filter((t,l)=>l!==e)),l.displayContentItem.type===x.cM.NODE){let e=l.displayContentItem.nodeId;H(t=>{if(t){let l=t.nodeIds.filter(t=>t!==e),a=t.nodeThumbnails,n=a&&l.reduce((e,t)=>(e[t]=a[t],e),{});return{...t,nodeIds:l,nodeThumbnails:n}}return null})}$(t)},[et]),eC=a.useCallback((e,t)=>{eE(e.files,t),q(!1)},[eE]),ey=a.useRef(null),ek=!!G?.nodeIds?.length,{openPostFromFileModal:ev,attachedFileData:eI}=(0,T.Ld)({setLinkedFileNodeInfo:H,numUserContentItems:et.length,hasNodeContent:ek,parentModalRef:ey,attachedFileKey:X,lockedFileKey:e.lockedFileKey,currentOrgId:l?.id}),eN=a.useCallback(()=>{let t=et.map(e=>e.displayContentItem);return a.createElement(f.Y,{className:r()(L.xe,Y&&L.w8),isDragTarget:()=>!0,onTargetDragEnter:()=>q(!0),onTargetDragLeave:()=>q(!1),onTargetDrop:e=>eC(e)},a.createElement(A.Zo,{attachedFile:eI,contentItems:t,deleteItemAtIdx:M?void 0:eh,dragging:Y,mode:"edit",onFileInputChange:eb,onReorderCallback:M?void 0:en,openPostFromFileModal:ev,pageBackgroundColor:e.feedPost.backgroundColor??void 0,scrollable:!1,selectedIdx:V,setContentPreview:ed,setSelectedContent:es,setSelectedIdx:$,shouldScrollToIndex:null,snapshotStates:er,staticContent:!0}))},[e.feedPost,Y,en,eh,M,et,eC,V,eb,es,er,ed,ev,eI]),e_=a.useCallback(e=>{e.keyCode===c.Uz.ESCAPE&&Q()},[Q]);return l&&d&&(0,s.k)().xr_debounce_threshold?a.createElement("div",{className:L.RO,onKeyDown:e_,role:"textbox",tabIndex:0,ref:ey},a.createElement("div",{className:L.q3},eN(),l&&d?a.createElement("div",{className:L.DA},a.createElement(K.FeedPostUnifiedComposer,{autofocus:!0,canUnlinkFile:!ek&&!e.lockedFileKey,currentOrgId:l.id,description:em,displayDecoratorsDownwards:!0,editableTypeaheadClass:B.up,fileData:eI,hideSubmitButton:!0,lockFileAddition:et.length>=x.e3,mentionables:ep,minimized:!1,onSubmit:u?void 0:eg,openPostFromFileModal:()=>ev({skipFrameSelection:!ek}),parentRef:ey,readOnly:M,submitOnEnter:!1,title:ec,unlinkFile:()=>H(null),updateDescription:ef,updateTitle:eu,user:d})):null),a.createElement("div",{className:L.CQ},a.createElement("div",{className:L._f}),a.createElement("div",{className:L.UD},a.createElement(p.nR,{onClick:e=>{e.stopPropagation(),W()}},(0,b.tx)("fig_feed.discard_edit")),a.createElement(p.$$,{onClick:e=>{if(!M)return j(!0),eg(e).finally(()=>{j(!1)})},disabled:u,dataTestId:"feed-post-post",className:M?L.zb:L.pb},M&&a.createElement("div",{className:L.YI},a.createElement(g.kt,{shouldMatchTextColor:!0,size:"medium"})),M?(0,b.tx)("fig_feed.saving"):(0,b.tx)("general.save"))))):null}}}]);

//# debugId=01108875-d422-5138-b06c-d4d72788e83a

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/274129f8883b33289a7328fabc695933d557cf13/8aeabb76-10187763dfce7ed7.min.js.map